<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- MovieMAppeer.xml -->

<mapper namespace="repository.mapper.MovieMapper">
	<cache />
<!-- 영화테이블만 필요할 때 -->
 	<resultMap id="baseResultMap" type="movie">
		<id column="movie_num" jdbcType="BIGINT" property="movieNum" />
		<result column="movie_title" jdbcType="VARCHAR" property="movieTitle" />
		<result column="movie_genr" jdbcType="VARCHAR" property="movieGenr" />
		<result column="movie_time" jdbcType="VARCHAR" property="movieTime" />
		<result column="movie_dire" jdbcType="VARCHAR" property="movieDire" />
		<result column="movie_actor" jdbcType="VARCHAR" property="movieActor" />
		<result column="movie_grade" jdbcType="VARCHAR" property="movieGrade" />
		<result column="movie_con" jdbcType="VARCHAR" property="movieCon" />
		<result column="movie_date" jdbcType="TIMESTAMP" property="movieDate" />
		<result column="member_num" jdbcType="BIGINT" property="memberNum" />
		<result column="movie_poster" jdbcType="VARCHAR" property="moviePoster" />
	</resultMap>
	
	
	
	<select id="detailView"  parameterType="Long" resultType="Movie" resultMap="baseResultMap">
	SELECT * FROM movie
	WHERE movie_num = #{movieNum}
	</select>


	<select id="selectMovieByCondition" parameterType="Long"
		resultMap="baseResultMap">

		Select
		*
		<!-- movie_num,
		movie_title,
		movie_genr,
		movie_time,
		movie_dire,
		movie_actor,
		movie_grade,
		movie_con,
		movie_date,
		member_num -->
		FROM movie
 		<where>

			<if test="movieNum != null ">
				movie_num = #{movieNum}
			</if>
		</where> 


	</select> 
	
	<insert id="insertMovie" parameterType="Movie" >
		
		insert into movie(
		movie_num,
		movie_title,
		movie_genr,
		movie_time,
		movie_dire,
		movie_actor,
		movie_grade,
		movie_con,
		movie_date,
		movie_poster
		)
					values(
					MOVIE_NUM_SEQ.NEXTVAL,
					#{movieTitle},
					#{movieGenr},
					#{movieTime},
					#{movieDire},
					#{movieActor},
					#{movieGrade},
					#{movieCon},
					#{movieDate},
					#{moviePoster}
					)
			
	</insert>

	
	 <update id = "updateMovie" parameterType="Movie">
		UPDATE movie
		<set>
			<if test ="movieTitle != null">
				movie_title = #{movieTitle},
			</if>
			<if test ="movieGenr != null">
				movie_genr = #{movieGenr},
			</if>
			<if test ="movieTime != null">
				movie_time = #{movieTime},
			</if>
			<if test ="movieDire != null">
				movie_dire = #{movieDire},
			</if>
			<if test ="movieActor != null">
				movie_actor = #{movieActor},
			</if>
			<if test ="movieGrade != null">
				movie_grade = #{movieGrade},
			</if>
			<if test ="movieCon != null">
				movie_con = #{movieCon},
			</if>			
			<if test ="movieDate != null">
				movie_date = #{movieDate}
			</if>
			<if test ="moviePoster != null">
				movie_poster = #{moviePoster}
			</if>
		
		</set>
		<where>
			movie_num = #{movieNum}
		</where>
	
	</update>
	
 	<delete id="deleteMovie" parameterType="long">
		delete from movie
		where movie_num = #{movieNum}
	</delete> 
	
	<!-- :::::::::::::::::첨부관련 매퍼:::::::::::::::::::: -->
	
	<!-- 영화 번호와 파일정보를 같이 가져올때 -->
<!-- 	<resultMap id="collectionResultMap" type="movie">
		<id column="movie_num" jdbcType="BIGINT" property="movieNum" />
		<result column="movie_title" jdbcType="VARCHAR" property="movieTitle" />
		<result column="movie_genr" jdbcType="VARCHAR" property="movieGenr" />
		<result column="movie_time" jdbcType="VARCHAR" property="movieTime" />
		<result column="movie_dire" jdbcType="VARCHAR" property="movieDire" />
		<result column="movie_actor" jdbcType="VARCHAR" property="movieActor" />
		<result column="movie_grade" jdbcType="VARCHAR" property="movieGrade" />
		<result column="movie_con" jdbcType="VARCHAR" property="movieCon" />
		<result column="movie_date" jdbcType="TIMESTAMP" property="movieDate" />
		<result column="member_num" jdbcType="BIGINT" property="memberNum" />

		<collection property="files" ofType="MovieAttach">
			<id column="fullname" property="fullname" />
			<result column="movie_num" property="movieNum" />
			<result column="regdate" property="regdate" />
		</collection>

	</resultMap>
	 -->
	<!-- setter를 이용해서 저장 -->


	<select id="getAttach" parameterType="long" resultMap="baseResultMap">
		SELECT movie_poster 
		FROM movie
		WHERE movie_num =
		#{movieNum} 
	
		
	</select>
<!-- 	 03. 게시글의 첨부파일 업데이트처리(입력처리)
	<insert id="updateAttach">
		INSERT INTO movie_attach (
		fullname, movie_num
		) VALUES (
		#{fullName}, #{movieNum}
		)
	</insert>

	03. 게시글의 첨부파일 삭제처리
	<delete id="deleteAttach">
		DELETE FROM movie_attach
		WHERE fullname = #{fullname}
	</delete> -->


</mapper>